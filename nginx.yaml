# - name: install nginx
#   hosts: localhost
#   connection: local
#   become: ec2-user
#   remote_user: ec2-user
#   tasks:
#   - name: Installs Nginx web server
#     shell: | 
#       cd ~/cdn
#       npm run build

- name: clone git repo and build it
  hosts: webservers
  become: yes
  remote_user: ec2-user
  tasks:
  - name: Install dependencies
    shell: |
     sudo yum update -y
     sudo yum install git -y
     git version
     yum install -y gcc-c++ make
     curl -sL https://rpm.nodesource.com/setup_14.x | sudo -E bash -
     yum install -y nodejs
  - name: clone git repo
    git:
       repo: https://github.com/AliHaider5674/cdn.git
       dest: /home/ec2-user/repo/
       clone: yes
       update: yes
  - name: make build
    shell: | 
      cd ~/repo
      npm run build
  # - name: "Copy build  file from master to target"
  #   copy: src=../cdn/build/  dest=/usr/share/nginx/html
  # sudo amazon-linux-extras install nginx1
